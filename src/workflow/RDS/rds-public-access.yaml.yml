title: Can't access RDS instance from the Internet.
data:
  dbIdentifier: ''
  securityGroupIds: []
  subnets: []
input:
  - label: DB Identifier
    placeholder: ''
    store: dbIdentifier
steps:
  - name: Retrieve database instance info.
    js: |
      try {
        let res = await $.aws.rds.send(
          new $.rds.DescribeDBInstancesCommand({
            DBInstanceIdentifier: $.data.dbIdentifier,
          })
        );
        if (res.DBInstances.length === 0) {
          $.err = `Database ${$.data.dbIdentifier} not found. Please check the identifier, your AWS profile, and the selected region. `;
          return;
        }
        $.data.db = res.DBInstances[0];

        let port = $.jp.query(res, "$..Port")[0];
        let username = $.jp.query(res, "$..MasterUsername")[0];
        let PubliclyAccessible = $.jp.query(res, "$..PubliclyAccessible")[0];
        $.data.securityGroupIds = $.jp.query(
          res,
          "$..VpcSecurityGroups[?(@.Status=='active')].VpcSecurityGroupId"
        );
        $.data.subnets = $.jp.query(
          res,
          "$..Subnets[?(@.SubnetStatus=='Active')].SubnetIdentifier"
        );

        if (!PubliclyAccessible) {
          $.err = `Database is not public accessible. Please modify your database to enable "Public access" `;
          return;
        }

        $.ok = `Got database username: ${username}, port: ${port}, active security groups: ${$.data.securityGroupIds.join(
          ", "
        )}, active subnets: ${$.data.subnets.join(", ")}. `;
      } catch (e) {
        $.err = e;
        return;
      }
